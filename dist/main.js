(()=>{var e={18:e=>{"use strict";e.exports=require("tty")},23:e=>{"use strict";e.exports=require("util")},33:(e,t,r)=>{var n=r(18),s=r(23);(t=e.exports=r(910)).init=function(e){e.inspectOpts={};for(var r=Object.keys(t.inspectOpts),n=0;n<r.length;n++)e.inspectOpts[r[n]]=t.inspectOpts[r[n]]},t.log=function(){return i.write(s.format.apply(s,arguments)+"\n")},t.formatArgs=function(e){var r=this.namespace;if(this.useColors){var n=this.color,s="  [3"+n+";1m"+r+" [0m";e[0]=s+e[0].split("\n").join("\n"+s),e.push("[3"+n+"m+"+t.humanize(this.diff)+"[0m")}else e[0]=(new Date).toUTCString()+" "+r+" "+e[0]},t.save=function(e){null==e?delete process.env.DEBUG:process.env.DEBUG=e},t.load=c,t.useColors=function(){return"colors"in t.inspectOpts?Boolean(t.inspectOpts.colors):n.isatty(o)},t.colors=[6,2,3,4,5,1],t.inspectOpts=Object.keys(process.env).filter((function(e){return/^debug_/i.test(e)})).reduce((function(e,t){var r=t.substring(6).toLowerCase().replace(/_([a-z])/g,(function(e,t){return t.toUpperCase()})),n=process.env[t];return n=!!/^(yes|on|true|enabled)$/i.test(n)||!/^(no|off|false|disabled)$/i.test(n)&&("null"===n?null:Number(n)),e[r]=n,e}),{});var o=parseInt(process.env.DEBUG_FD,10)||2;1!==o&&2!==o&&s.deprecate((function(){}),"except for stderr(2) and stdout(1), any other usage of DEBUG_FD is deprecated. Override debug.log if you want to use a different log function (https://git.io/debug_fd)")();var i=1===o?process.stdout:2===o?process.stderr:function(e){var t;switch(process.binding("tty_wrap").guessHandleType(e)){case"TTY":(t=new n.WriteStream(e))._type="tty",t._handle&&t._handle.unref&&t._handle.unref();break;case"FILE":(t=new(r(896).SyncWriteStream)(e,{autoClose:!1}))._type="fs";break;case"PIPE":case"TCP":(t=new(r(278).Socket)({fd:e,readable:!1,writable:!0})).readable=!1,t.read=null,t._type="pipe",t._handle&&t._handle.unref&&t._handle.unref();break;default:throw new Error("Implement me. Unknown stream file type!")}return t.fd=e,t._isStdio=!0,t}(o);function c(){return process.env.DEBUG}t.formatters.o=function(e){return this.inspectOpts.colors=this.useColors,s.inspect(e,this.inspectOpts).split("\n").map((function(e){return e.trim()})).join(" ")},t.formatters.O=function(e){return this.inspectOpts.colors=this.useColors,s.inspect(e,this.inspectOpts)},t.enable(c())},157:e=>{"use strict";e.exports=require("electron")},278:e=>{"use strict";e.exports=require("net")},313:(e,t,r)=>{var n=r(928),s=r(317).spawn,o=r(753)("electron-squirrel-startup"),i=r(157).app,c=function(e,t){var r=n.resolve(n.dirname(process.execPath),"..","Update.exe");o("Spawning `%s` with args `%s`",r,e),s(r,e,{detached:!0}).on("close",t)};e.exports=function(){if("win32"===process.platform){var e=process.argv[1];o("processing squirrel command `%s`",e);var t=n.basename(process.execPath);if("--squirrel-install"===e||"--squirrel-updated"===e)return c(["--createShortcut="+t],i.quit),!0;if("--squirrel-uninstall"===e)return c(["--removeShortcut="+t],i.quit),!0;if("--squirrel-obsolete"===e)return i.quit(),!0}return!1}()},317:e=>{"use strict";e.exports=require("child_process")},585:e=>{var t=1e3,r=60*t,n=60*r,s=24*n;function o(e,t,r){if(!(e<t))return e<1.5*t?Math.floor(e/t)+" "+r:Math.ceil(e/t)+" "+r+"s"}e.exports=function(e,i){i=i||{};var c,a=typeof e;if("string"===a&&e.length>0)return function(e){if(!((e=String(e)).length>100)){var o=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(e);if(o){var i=parseFloat(o[1]);switch((o[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*i;case"days":case"day":case"d":return i*s;case"hours":case"hour":case"hrs":case"hr":case"h":return i*n;case"minutes":case"minute":case"mins":case"min":case"m":return i*r;case"seconds":case"second":case"secs":case"sec":case"s":return i*t;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return i;default:return}}}}(e);if("number"===a&&!1===isNaN(e))return i.long?o(c=e,s,"day")||o(c,n,"hour")||o(c,r,"minute")||o(c,t,"second")||c+" ms":function(e){return e>=s?Math.round(e/s)+"d":e>=n?Math.round(e/n)+"h":e>=r?Math.round(e/r)+"m":e>=t?Math.round(e/t)+"s":e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},753:(e,t,r)=>{"undefined"!=typeof process&&"renderer"===process.type?e.exports=r(833):e.exports=r(33)},833:(e,t,r)=>{function n(){var e;try{e=t.storage.debug}catch(e){}return!e&&"undefined"!=typeof process&&"env"in process&&(e=process.env.DEBUG),e}(t=e.exports=r(910)).log=function(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},t.formatArgs=function(e){var r=this.useColors;if(e[0]=(r?"%c":"")+this.namespace+(r?" %c":" ")+e[0]+(r?"%c ":" ")+"+"+t.humanize(this.diff),r){var n="color: "+this.color;e.splice(1,0,n,"color: inherit");var s=0,o=0;e[0].replace(/%[a-zA-Z%]/g,(function(e){"%%"!==e&&(s++,"%c"===e&&(o=s))})),e.splice(o,0,n)}},t.save=function(e){try{null==e?t.storage.removeItem("debug"):t.storage.debug=e}catch(e){}},t.load=n,t.useColors=function(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type)||("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},t.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(e){}}(),t.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],t.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}},t.enable(n())},896:e=>{"use strict";e.exports=require("fs")},910:(e,t,r)=>{var n;function s(e){function r(){if(r.enabled){var e=r,s=+new Date,o=s-(n||s);e.diff=o,e.prev=n,e.curr=s,n=s;for(var i=new Array(arguments.length),c=0;c<i.length;c++)i[c]=arguments[c];i[0]=t.coerce(i[0]),"string"!=typeof i[0]&&i.unshift("%O");var a=0;i[0]=i[0].replace(/%([a-zA-Z%])/g,(function(r,n){if("%%"===r)return r;a++;var s=t.formatters[n];if("function"==typeof s){var o=i[a];r=s.call(e,o),i.splice(a,1),a--}return r})),t.formatArgs.call(e,i),(r.log||t.log||console.log.bind(console)).apply(e,i)}}return r.namespace=e,r.enabled=t.enabled(e),r.useColors=t.useColors(),r.color=function(e){var r,n=0;for(r in e)n=(n<<5)-n+e.charCodeAt(r),n|=0;return t.colors[Math.abs(n)%t.colors.length]}(e),"function"==typeof t.init&&t.init(r),r}(t=e.exports=s.debug=s.default=s).coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){t.enable("")},t.enable=function(e){t.save(e),t.names=[],t.skips=[];for(var r=("string"==typeof e?e:"").split(/[\s,]+/),n=r.length,s=0;s<n;s++)r[s]&&("-"===(e=r[s].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.substr(1)+"$")):t.names.push(new RegExp("^"+e+"$")))},t.enabled=function(e){var r,n;for(r=0,n=t.skips.length;r<n;r++)if(t.skips[r].test(e))return!1;for(r=0,n=t.names.length;r<n;r++)if(t.names[r].test(e))return!0;return!1},t.humanize=r(585),t.names=[],t.skips=[],t.formatters={}},915:function(e,t,r){"use strict";var n,s=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var s=Object.getOwnPropertyDescriptor(t,r);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,s)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=n(e),i=0;i<r.length;i++)"default"!==r[i]&&s(t,e,r[i]);return o(t,e),t}),c=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(s,o){function i(e){try{a(n.next(e))}catch(e){o(e)}}function c(e){try{a(n.throw(e))}catch(e){o(e)}}function a(e){var t;e.done?s(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(i,c)}a((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const a=r(157),u=i(r(928)),l=i(r(896)),d=r(317),p=r(23);r(313)&&a.app.quit();let f=null;const g=()=>{f=new a.BrowserWindow({width:900,height:700,webPreferences:{nodeIntegration:!1,contextIsolation:!0,preload:u.join(__dirname,"preload.js")}}),f.loadFile(u.join(__dirname,"index.html"))};a.app.on("ready",g),a.app.on("window-all-closed",(()=>{"darwin"!==process.platform&&a.app.quit()})),a.app.on("activate",(()=>{0===a.BrowserWindow.getAllWindows().length&&g()}));const m=(0,p.promisify)(d.exec);a.ipcMain.handle("clean-repository",((e,t)=>c(void 0,void 0,void 0,(function*(){try{const{repoPath:e,bfgPath:r,textReplacements:n,fileSizes:s}=t;if(!l.existsSync(e))return{success:!1,message:"Repository path does not exist"};if(!l.existsSync(r))return{success:!1,message:"BFG jar file path does not exist"};let o=`java -jar "${r}" `;if(n&&n.length>0){const e=u.join(a.app.getPath("temp"),"bfg-replacements.txt");l.writeFileSync(e,n.join("\n")),o+=`--replace-text "${e}" `}s&&s.trim()&&(o+=`--strip-blobs-bigger-than ${s} `),o+=`"${e}"`;const{stdout:i,stderr:c}=yield m(o);return{success:!0,message:"Repository cleaned successfully",output:i,error:c}}catch(e){return{success:!1,message:"Error cleaning repository",error:e instanceof Error?e.message:String(e)}}})))),a.ipcMain.handle("select-repository",(()=>c(void 0,void 0,void 0,(function*(){return f?yield a.dialog.showOpenDialog(f,{properties:["openDirectory"],title:"Select Git Repository"}):{canceled:!0}})))),a.ipcMain.handle("select-bfg-jar",(()=>c(void 0,void 0,void 0,(function*(){return f?yield a.dialog.showOpenDialog(f,{properties:["openFile"],filters:[{name:"JAR Files",extensions:["jar"]}],title:"Select BFG Repo-Cleaner JAR"}):{canceled:!0}})))),a.ipcMain.handle("clone-repository",((e,t)=>c(void 0,void 0,void 0,(function*(){var e;try{const{repoUrl:r,targetDir:n}=t;if(!r)return{success:!1,message:"Repository URL is required"};l.existsSync(n)||l.mkdirSync(n,{recursive:!0});const s=(null===(e=r.split("/").pop())||void 0===e?void 0:e.replace(/\.git$/,""))||"cloned-repo",o=u.join(n,`${s}.git`),i=`git clone --mirror "${r}" "${o}"`,{stdout:c,stderr:a}=yield m(i);return{success:!0,message:"Repository cloned successfully with --mirror",output:c,repoPath:o,error:a}}catch(e){return{success:!1,message:"Error cloning repository",error:e instanceof Error?e.message:String(e)}}})))),a.ipcMain.handle("select-clone-directory",(()=>c(void 0,void 0,void 0,(function*(){return f?yield a.dialog.showOpenDialog(f,{properties:["openDirectory"],title:"Select Directory to Clone Repository Into"}):{canceled:!0}})))),a.ipcMain.handle("run-post-cleaning-commands",((e,t)=>c(void 0,void 0,void 0,(function*(){try{const{repoPath:e}=t;if(!l.existsSync(e))return{success:!1,message:"Repository path does not exist"};console.log(`Running post-cleaning commands in path: ${e}`);let r=`cd "${e}" && git reflog expire --expire=now --all`;console.log(`Executing command: ${r}`);const n=yield m(r);console.log("Reflog result:",n.stdout,n.stderr);let s=`cd "${e}" && git gc --prune=now --aggressive`;console.log(`Executing command: ${s}`);const o=yield m(s);console.log("GC result:",o.stdout,o.stderr);let i=`cd "${e}" && git remote -v`;const c=yield m(i);console.log("Remote check result:",c.stdout);let a="";if(c.stdout.includes("origin")){let t=`cd "${e}" && git push --mirror`;console.log(`Executing command: ${t}`);try{const e=yield m(t);a=`Push result: ${e.stdout||"Success!"}\n${e.stderr||""}`,console.log("Push result:",e.stdout,e.stderr)}catch(e){a=`Push failed: ${e instanceof Error?e.message:String(e)}`,console.error("Push error:",a)}}else a="Skipped push: No origin remote configured.",console.log(a);return{success:!0,message:"Post-cleaning commands executed successfully",output:`Reflog: ${n.stdout||"Success!"}\n\nGC: ${o.stdout||"Success!"}\n\n${a}`}}catch(e){return console.error("Error in post-cleaning commands:",e),{success:!1,message:"Error executing post-cleaning commands",error:e instanceof Error?e.message:String(e)}}})))),a.ipcMain.handle("reset-and-cleanup",((e,t)=>c(void 0,void 0,void 0,(function*(){try{const{repoPath:e}=t;if(e&&l.existsSync(e)){l.rmSync(e,{recursive:!0,force:!0});const t=u.dirname(e),r=u.basename(e),n=u.join(t,`${r}.bfg-report`);l.existsSync(n)&&l.rmSync(n,{recursive:!0,force:!0})}return{success:!0,message:"Reset and cleanup completed successfully"}}catch(e){return{success:!1,message:"Error during reset and cleanup",error:e instanceof Error?e.message:String(e)}}}))))},928:e=>{"use strict";e.exports=require("path")}},t={};!function r(n){var s=t[n];if(void 0!==s)return s.exports;var o=t[n]={exports:{}};return e[n].call(o.exports,o,o.exports,r),o.exports}(915)})();
//# sourceMappingURL=main.js.map